sudo: required

language: bash

services:
  - docker

install:
  - docker build -t quay.io/${TRAVIS_REPO_SLUG:0:6}/${TRAVIS_REPO_SLUG:14}:${TRAVIS_COMMIT:0:7} .

script:
  - docker run --rm --entrypoint /bin/bash quay.io/${TRAVIS_REPO_SLUG:0:6}/${TRAVIS_REPO_SLUG:14}:${TRAVIS_COMMIT:0:7} -c 'ls -l $(ls -d /usr/lib/postgresql/9.*)/lib | grep postgis'

before_deploy:
  - docker login -e . -p "${QUAY_PASSWORD}" -u "${QUAY_USER}" quay.io

deploy:
- provider: script
  script: ".travis/deploy.sh"
  on:
    repo: azavea/docker-postgis
    branch: develop
- provider: script
  script: ".travis/deploy.sh"
  on:
    repo: azavea/docker-postgis
    tags: true
